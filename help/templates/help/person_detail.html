{% extends "help/base.html" %}
{% load custom_filters %}

{% block title %}{{ person }} - Sistemul de eviden»õƒÉ a ajutorului{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <div>
            <h2 class="card-title">Informa»õii despre persoanƒÉ</h2>
            <p style="color: #64748b; margin-top: 5px;">#{{ person.id }} ‚Ä¢ AdƒÉugat la {{ person.created_at|date:"d.m.Y la H:i" }}</p>
        </div>
        <div style="display: flex; gap: 10px;">
            <a href="{% url 'person_export_pdf' person.id %}" class="btn btn-success btn-small" target="_blank">üìÑ Export PDF</a>
            <a href="{% url 'person_edit' person.id %}" class="btn btn-secondary btn-small">‚úèÔ∏è Modificare</a>
            <a href="{% url 'people_list' %}" class="btn btn-secondary btn-small">‚Üê √énapoi</a>
        </div>
    </div>
    
    <!-- Informa»õii de bazƒÉ -->
    <div style="background: #f9fafb; padding: 20px; border-radius: 12px; margin-bottom: 30px;">
        <h3 style="margin-bottom: 20px; color: #1f2937; font-size: 18px;">Informa»õii de bazƒÉ</h3>
        
        <div class="grid grid-2">
            {% for field in base_fields %}
                {% with value=person.base_data|get_item:field.field_key %}
                <div style="padding: 15px; background: white; border-radius: 8px; border: 1px solid #e5e7eb;">
                    <div style="color: #64748b; font-size: 12px; font-weight: 600; margin-bottom: 8px;">
                        {{ field.name }}
                    </div>
                    <div style="color: #1f2937; font-size: 15px; font-weight: 500;">
                        {% if value %}
                            {{ value }}
                        {% else %}
                            <span style="color: #d1d5db;">‚Äî</span>
                        {% endif %}
                    </div>
                </div>
                {% endwith %}
            {% endfor %}
        </div>
    </div>
    
    <!-- Servicii furnizate -->
    <div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="color: #1f2937; font-size: 18px;">Servicii furnizate</h3>
            <a href="{% url 'service_add' person.id %}" class="btn btn-primary btn-small">‚ûï AdƒÉuga»õi serviciu</a>
        </div>
        
        {% if editable_services or readonly_services %}
            <!-- Servicii editabile -->
            {% if editable_services %}
            <div style="margin-bottom: 30px;">
                <h4 style="color: #10b981; margin-bottom: 15px; font-size: 14px; font-weight: 600;">
                    ‚úèÔ∏è SERVICIILE MELE (EDITABILE)
                </h4>
                <div class="grid grid-2">
                    {% for service in editable_services %}
                    <div style="background: white; border: 2px solid #10b981; border-radius: 12px; padding: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <h4 style="color: #1f2937; margin-bottom: 8px; font-size: 16px;">
                                    {{ service.help_category.name }}
                                </h4>
                                <span class="badge badge-{{ service.status }}">
                                    {{ service.get_status_display }}
                                </span>
                            </div>
                            <a href="{% url 'service_edit' service.id %}" 
                               class="btn btn-primary btn-small" 
                               style="white-space: nowrap;">
                                Modificare
                            </a>
                        </div>
                        
                        {% if service.custom_data %}
                        <div style="border-top: 1px solid #e5e7eb; padding-top: 15px;">
                            {% for category in editable_services|get_custom_fields %}
                                {% if category.id == service.help_category.id %}
                                    {% for field in category.custom_fields.all %}
                                        {% with value=service.custom_data|get_item:field.field_key %}
                                        <div style="margin-bottom: 12px;">
                                            <div style="color: #64748b; font-size: 12px; font-weight: 600; margin-bottom: 4px;">
                                                {{ field.name }}
                                            </div>
                                            <div style="color: #1f2937; font-size: 14px;">
                                                {% if value %}{{ value }}{% else %}<span style="color: #d1d5db;">‚Äî</span>{% endif %}
                                            </div>
                                        </div>
                                        {% endwith %}
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                        {% if service.notes %}
                        <div style="border-top: 1px solid #e5e7eb; padding-top: 15px; margin-top: 15px;">
                            <div style="color: #64748b; font-size: 12px; font-weight: 600; margin-bottom: 8px;">
                                Noti»õe
                            </div>
                            <div style="color: #1f2937; font-size: 14px; line-height: 1.5;">
                                {{ service.notes }}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- Doar pentru vizualizare -->
            {% if readonly_services %}
            <div style="margin-bottom: 30px;">
                <h4 style="color: #64748b; margin-bottom: 15px; font-size: 14px; font-weight: 600;">
                    üëÅÔ∏è SERVICIILE ALTOR FURNIZORI (DOAR VIZUALIZARE)
                </h4>
                <div class="grid grid-2">
                    {% for service in readonly_services %}
                    <div style="background: white; border: 2px solid #d1d5db; border-radius: 12px; padding: 20px; opacity: 0.8;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <h4 style="color: #1f2937; margin-bottom: 8px; font-size: 16px;">
                                    {{ service.help_category.name }}
                                </h4>
                                <span class="badge badge-{{ service.status }}">
                                    {{ service.get_status_display }}
                                </span>
                            </div>
                            <span style="background: #f3f4f6; color: #64748b; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600;">
                                Doar vizualizare
                            </span>
                        </div>
                        
                        {% if service.custom_data %}
                        <div style="border-top: 1px solid #e5e7eb; padding-top: 15px;">
                            {% for category in readonly_services|get_custom_fields %}
                                {% if category.id == service.help_category.id %}
                                    {% for field in category.custom_fields.all %}
                                        {% with value=service.custom_data|get_item:field.field_key %}
                                        <div style="margin-bottom: 12px;">
                                            <div style="color: #64748b; font-size: 12px; font-weight: 600; margin-bottom: 4px;">
                                                {{ field.name }}
                                            </div>
                                            <div style="color: #1f2937; font-size: 14px;">
                                                {% if value %}{{ value }}{% else %}<span style="color: #d1d5db;">‚Äî</span>{% endif %}
                                            </div>
                                        </div>
                                        {% endwith %}
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                        {% if service.notes %}
                        <div style="border-top: 1px solid #e5e7eb; padding-top: 15px; margin-top: 15px;">
                            <div style="color: #64748b; font-size: 12px; font-weight: 600; margin-bottom: 8px;">
                                Noti»õe
                            </div>
                            <div style="color: #1f2937; font-size: 14px; line-height: 1.5;">
                                {{ service.notes }}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üìã</div>
                <h3 style="margin-bottom: 10px;">Nu au fost adƒÉugate servicii</h3>
                <p style="margin-bottom: 20px;">AdƒÉuga»õi primul serviciu pentru aceastƒÉ persoanƒÉ</p>
                <a href="{% url 'service_add' person.id %}" class="btn btn-primary">
                    ‚ûï AdƒÉuga»õi serviciu
                </a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}